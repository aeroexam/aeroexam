<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Aero Exam Modules</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 30px;
}

.container {
    max-width: 900px;
    margin: auto;
}

button {
    padding: 10px 20px;
    margin: 5px;
    cursor: pointer;
}

.hidden {
    display: none;
}

.card {
    border: 1px solid #ccc;
    padding: 20px;
    margin: 10px 0;
    border-radius: 6px;
}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="home">
    <h2>Home</h2>
    <button onclick="showModules()">Exam Modules</button>
    <button onclick="showAdmin()">Admin Access</button>
</div>

<!-- MODULE SELECTION -->
<div id="modules" class="hidden">
    <h2>Select Exam Module</h2>
    <button onclick="confirmStart('DJI')">DJI</button>
    <button onclick="confirmStart('Skydio')">Skydio</button>
    <button onclick="confirmStart('Processing')">Processing</button>
    <br><br>
    <button onclick="goHome()">Back</button>
</div>

<!-- EXAM AREA -->
<div id="exam" class="hidden"></div>

<!-- ADMIN LOGIN -->
<div id="adminLogin" class="hidden">
    <h2>Admin Login</h2>
    <input id="adminUserInput" placeholder="Username"><br><br>
    <input id="adminPassInput" type="password" placeholder="Password"><br><br>
    <button onclick="adminLogin()">Login</button>
    <button onclick="goHome()">Back</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
    <h2>Admin Panel</h2>
    <button onclick="viewResults()">View Results</button>
    <button onclick="changeCredentials()">Change Username/Password</button>
    <button onclick="goHome()">Logout</button>
</div>

</div>

<script>

/* ==============================
   INITIAL DATA SETUP
============================== */

if (!localStorage.getItem("adminUser")) {
    localStorage.setItem("adminUser", "admin");
    localStorage.setItem("adminPass", "aeroexammodules");
}

/* ==============================
   QUESTION BANK (Simple Clean Version)
   Replace with expanded version later if needed
============================== */

const questionBank = {
    DJI: generateSampleQuestions("DJI"),
    Skydio: generateSampleQuestions("Skydio"),
    Processing: generateSampleQuestions("Processing")
};

function generateSampleQuestions(subject) {
    const questions = [];
    const difficulties = [
        ...Array(45).fill("easy"),
        ...Array(22).fill("moderate"),
        ...Array(8).fill("difficult")
    ];

    for (let i = 0; i < 75; i++) {
        questions.push({
            question: subject + " Question " + (i + 1) + " (" + difficulties[i] + ")",
            options: [
                "Correct Answer",
                "Wrong Option A",
                "Wrong Option B",
                "Wrong Option C"
            ],
            answer: 0,
            difficulty: difficulties[i]
        });
    }

    return questions;
}

/* ==============================
   NAVIGATION
============================== */

function showModules() {
    hideAll();
    document.getElementById("modules").classList.remove("hidden");
}

function showAdmin() {
    hideAll();
    document.getElementById("adminLogin").classList.remove("hidden");
}

function goHome() {
    hideAll();
    document.getElementById("home").classList.remove("hidden");
}

function hideAll() {
    document.getElementById("home").classList.add("hidden");
    document.getElementById("modules").classList.add("hidden");
    document.getElementById("exam").classList.add("hidden");
    document.getElementById("adminLogin").classList.add("hidden");
    document.getElementById("adminPanel").classList.add("hidden");
}

/* ==============================
   EXAM LOGIC
============================== */

let selectedQuestions = [];
let currentModule = "";

function confirmStart(module) {
    if (confirm("Start " + module + " exam?")) {
        const name = prompt("Enter your name:");
        if (name) {
            startExam(module, name);
        }
    }
}

function startExam(module, name) {
    currentModule = module;
    selectedQuestions = shuffle(questionBank[module]).slice(0, 25);

    hideAll();
    const examDiv = document.getElementById("exam");
    examDiv.innerHTML = "<h2>" + module + " Exam</h2>";
    examDiv.innerHTML += "<form id='examForm'>";

    selectedQuestions.forEach(function(q, i) {
        examDiv.innerHTML += "<div class='card'>";
        examDiv.innerHTML += "<p>" + (i + 1) + ". " + q.question + "</p>";

        q.options.forEach(function(opt, j) {
            examDiv.innerHTML +=
                "<input type='radio' name='q" + i + "' value='" + j + "'> " +
                opt + "<br>";
        });

        examDiv.innerHTML += "</div>";
    });

    examDiv.innerHTML += "<button type='button' onclick='submitExam(\"" + name + "\")'>Submit</button>";
    examDiv.innerHTML += "</form>";

    examDiv.classList.remove("hidden");
}

function submitExam(name) {
    if (!confirm("Are you sure to submit?")) return;

    let score = 0;
    const answers = [];

    selectedQuestions.forEach(function(q, i) {
        const selected = document.querySelector("input[name='q" + i + "']:checked");
        const val = selected ? parseInt(selected.value) : -1;

        if (val === q.answer) score++;

        answers.push({
            question: q.question,
            selected: val,
            correct: q.answer
        });
    });

    const result = {
        name: name,
        module: currentModule,
        score: score,
        date: new Date().toLocaleString(),
        answers: answers
    };

    const results = JSON.parse(localStorage.getItem("results") || "[]");
    results.push(result);
    localStorage.setItem("results", JSON.stringify(results));

    alert("Score: " + score + "/25");
    goHome();
}

/* ==============================
   ADMIN
============================== */

function adminLogin() {
    const u = document.getElementById("adminUserInput").value;
    const p = document.getElementById("adminPassInput").value;

    if (u === localStorage.getItem("adminUser") &&
        p === localStorage.getItem("adminPass")) {

        hideAll();
        document.getElementById("adminPanel").classList.remove("hidden");
    } else {
        alert("Invalid credentials");
    }
}

function viewResults() {
    const results = JSON.parse(localStorage.getItem("results") || "[]");
    alert(JSON.stringify(results, null, 2));
}

function changeCredentials() {
    const newUser = prompt("New Username:");
    const newPass = prompt("New Password:");

    if (newUser && newPass) {
        localStorage.setItem("adminUser", newUser);
        localStorage.setItem("adminPass", newPass);
        alert("Credentials updated.");
    }
}

/* ==============================
   UTILITY
============================== */

function shuffle(array) {
    return array.sort(function() {
        return 0.5 - Math.random();
    });
}

</script>

</body>
</html>
